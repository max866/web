<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Jr's Test Web</title>
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <style type="text/css">
        form {
            line-height: 2em;
        }

        button {
            background-color: #008CBA;
            border: none;
            color: white;
            padding: 10px 18px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 5px;
        }

        .col-1 {
            text-align: right;
        }

        select,
        input {
            padding: 5px 10px;
            border: 1px solid #888888;
            border-radius: 5px;
        }

        table {
            width: 400px;
            border: 1px solid #888888;
            border-collapse: collapse;
            line-height: 0px;
        }
    </style>
   <script>
    // --- 1. 抓取空氣盒子資料 (南投國中 NTJH) ---
    $.ajax({
        url: "https://data.lass-net.org/data/last.php?device_id=74DA38C7D236",
        dataType: "json",
        success: function (data) {
            if (data && data.feeds && data.feeds.length > 0) {
                let e = data.feeds[0];
                
                // 格式化時間 (API 回傳的是 ISO 格式)
                let obsDate = new Date(e.timestamp).toLocaleString();
                
                // 取得數值 (s_t0: 溫度, s_d0: PM2.5)
                let temp = e.s_t0 !== undefined ? e.s_t0 : "--";
                let pm25 = e.s_d0 !== undefined ? e.s_d0 : "--";

                $("#site").html("南投國中 (NTJH)");
                $("#time").html(obsDate);
                $("#temp").html(temp);
                // 如果 HTML 中有 pm25 欄位則填入
                if($("#pm25").length) $("#pm25").html(pm25);
            } else {
                $("#site").html("南投國中站台離線中");
            }
        },
        error: function () {
            $("#site").html("連線 LASS 失敗");
        }
    });

    // --- 2. 初始化頁面設定 (日期與自動整理) ---
    $(document).ready(function() {
        // 設定今天的日期
        var now = new Date();
        var today = now.getFullYear() + "-" + ("0" + (now.getMonth() + 1)).slice(-2) + "-" + ("0" + now.getDate()).slice(-2);
        $('#calendar').val(today);
        $('#calendar_moto').val(today);
        
        // 每 10 分鐘自動重新整理頁面
        setTimeout(function () { location.reload(); }, 600000);
    });

    // --- 3. Google Sheet 相關設定 ---
    var appUrl = "https://script.google.com/macros/s/AKfycbznrcLiQ1opYZrgD2jadsxU66wDdRzhfR98GXb26njY1IwzDY9gUVP4V596hbAAyzvtNQ/exec";
    var sheetsUrl = "https://docs.google.com/spreadsheets/d/1NzHDmTcM5IrTUMEaon16l6hTnDPQebnynZcMb50_aq8/edit?usp=sharing";

    function reset() {
        window.location.reload();
    }

    // --- 4. 記帳寫入功能 ---
    function saveValues_account() {
        var price = $('#price').val();
        if (price) {
            // 每次按下儲存時才抓取當下精確時間
            var currentTimestamp = new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString();
            
            var data = [[
                currentTimestamp, 
                $('#calendar').val(), 
                $('#payfor').val(), 
                $('#expenditure_type').val(), 
                price, 
                $('#content').val(), 
                $('#memo').val(), 
                $('#who').val()
            ]];

            var parameter = {
                url: sheetsUrl,
                name: 'expenditure',
                data: data.toString(),
                row: data.length,
                column: data[0].length,
                insertType: 'bottom'
            };
            
            $.get(appUrl, parameter);
            alert("記帳資料已送出");
            setTimeout(reset, 1000);
        }
    }

    // --- 5. 機車保養寫入功能 ---
    function saveValues_moto() {
        var currentTimestamp = new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString();
        
        var oil = $('#oil').prop("checked") ? 'v' : '';
        var engine_oil = $('#engine_oil').prop("checked") ? 'v' : '';
        var gear_oil = $('#gear_oil').prop("checked") ? 'v' : '';
        var other_parts = $('#other_parts').prop("checked") ? 'v' : '';

        var data = [[
            currentTimestamp, 
            $('#calendar_moto').val(), 
            $('#motocycle').val(), 
            $('#km').val(), 
            oil, 
            engine_oil, 
            gear_oil, 
            $('#other_parts_name').val(), 
            $('#memo_moto').val()
        ]];

        var parameter = {
            url: sheetsUrl,
            name: 'moto',
            data: data.toString(),
            row: data.length,
            column: data[0].length,
            insertType: 'bottom'
        };

        $.get(appUrl, parameter);
        alert("機車保養資料已送出");
        setTimeout(reset, 1000);
    }
</script>
</head>

<body>
    <div id="Observatory">
        測站：<span id="site"></span></br>
        資料時間：<span id="time"></span></br>
        現在溫度：<span id="temp"></span> &deg;c</br>
        <hr>
    </div>
    <div id="accountBook">
        <form id="accountBookForm">
            <h2>記帳簿</h2>
            日期：<input type="date" id="calendar" name="getdate"></br>
            支出來源：<select id="payfor" name="payfor">
                <option vaule="台幣現金"  selected>台幣現金</option>
                <option vaule="樂天信用卡">中國信託</option>
                <option vaule="樂天信用卡">永豐銀行</option>
                <option vaule="玉山國旅卡">玉山國旅卡</option>
                <option vaule="合庫信用卡">合庫信用卡</option>
                <option vaule="郵局">郵局</option>
                <option vaule="悠遊卡">悠遊卡</option>
            </select></br>
            支出總類：<select id="expenditure_type" name="expenditure_type">
                <option value="餐費">餐費</option>
                <option value="零食宵夜食品">零食宵夜食品</option>
                <option value="日用品">日用品</option>
                <option value="日用品">家庭用品</option>
                <option value="3C用品">3C用品</option>
                <option value="水電瓦斯">水電瓦斯</option>
                <option value="交通">交通</option>
                <option value="加油" selected>加油</option>
                <option value="電話通訊費">電話通訊費</option>
                <option value="娛樂">娛樂</option>
                <option value="汽機車維修">汽機車維修</option>
                <option value="教育進修">教育進修</option>
                <option value="寵物">寵物</option>
                <option value="保險">保險</option>
                <option value="税">税</option>
                <option value="醫療健康">醫療健康</option>
                <option value="投資">投資</option>
                <option value="禮金">禮金</option>
                <option value="償還貸款">償還貸款</option>
                <option value="信用卡費">信用卡費</option>
                <option value="其他">其他</option>
            </select><br />
            金額：<input type="number" id="price" name="price" min="0" onclick="this.value = '' " required><br />
            明細：<input type="text" id="content" name="content" autocomplete="on" onclick="this.value = '' "><br />
            備註：<input type="text" id="memo" name="memo" autocomplete="on" onclick="this.value = '' "><br />
            Who：<select id="who" name="who">
                <option vaule="鵬智" selected>鵬智</option>
                <option vaule="韻如">韻如</option></select></br>
        </form>
        <button id="saveValues_account" onclick="saveValues_account()">寫入Google表單_記帳</button>
        <button id="reset" onclick="reset()">reload</button></br>
        <hr>
    </div>
    <div>
            <h2>機車保養</h2>
            <table>
                <tr style="background-color: #f0f0f0;">
                    <td class="col-1">日期：</td>
                    <td class="col-2"><input type="date" id="calendar_moto" name="calendar_moto"></td>
                </tr>
                <tr>
                    <td class="col-1">Moto：</td>
                    <td class="col-2"><select id="motocycle" name="motocycle">
                            <option value="NVD-2806">NVD-2806</option>
                            <option value="MLW-069" selected>MLW-069</option>
                            <option value="322-DYC">322-DYC</option>
                            <option value="NUM-072">NUM-072</option>
                        </select></td>
                </tr>
                <tr style="background-color: #f0f0f0;">
                    <td class="col-1">里程數：</td>
                    <td class="col-2"><input type="number" id="km" name="km" min="0" onclick="this.value = '' "
                            required> km</td>
                </tr>
                <tr>
                    <td class="col-1">加油：</td>
                    <td class="col-2"><label for="oil"><input type="checkbox" id="oil" name="oil" value="加油">加油</label>
                    </td>

                </tr>
                <tr style="background-color: #f0f0f0;">
                    <td class="col-1">更換：</td>
                    <td class="col-2"><label for="engine_oil"><input type="checkbox" id="engine_oil" name="engine_oil"
                                value="機油">機油</label></td>
                </tr>
                <tr style="background-color: #f0f0f0;">
                    <td class="col-1"></td>
                    <td class="col-2"><label for="gear_oil"><input type="checkbox" id="gear_oil" name="gear_oil"
                                value="齒輪油">齒輪油</label></td>
                </tr>
                <tr style="background-color: #f0f0f0;">
                    <td class="col-1"></td>
                    <td class="col-2"><label for="other_parts"><input type="checkbox" id="other_parts"
                                name="other_parts" value="其他零件">其他零件</label>
                        <input type="text" id="other_parts_name" name="other_parts_name" autocomplete="on"
                            style="display:none"></td>
                </tr>
                <tr>
                    <td class="col-1">備註：</td>
                    <td class="col-2"><input type="text" id="memo_moto" name="memo_moto" autocomplete="on"
                            onclick="this.value = '' "></td>
                </tr>
                <tr>
                    <td style="text-align: center;padding: 10px;" colspan="2"><button id="saveValues_moto"
                            onclick="saveValues_moto()">寫入Google表單_moto</button></td>
                </tr>
            </table>
    </div>
    <div id="version">
        <p id="version">ver.20200924-4</p>
        <hr>
    </div>
    <script>
        const element = document.querySelector('#other_parts');
        element.addEventListener('click', function () {
            if ($('#other_parts').prop('checked')) {
                $('#other_parts_name').show();
            } else {
                $('#other_parts_name').hide();
            }
        });
    </script>
    <div id="superLottotickets">
        <p>威力彩建議(1,000,000次隨機)
        </p>
    </div>
    <div id="firstZone">第一區：</div>
    <div id="secondZone">第二區：</div>

      <button onclick="reloadNumbers()">Reload</button>

  <script>
    function getRandomNumbers(min, max, count) {
      const numbers = [];
      while (numbers.length < count) {
        const randomNum = Math.floor(Math.random() * (max - min + 1)) + min;
        if (!numbers.includes(randomNum)) {
          numbers.push(randomNum);
        }
      }
      return numbers.sort((a, b) => a - b);
    }

    function countOccurrences(arr) {
      const counts = {};
      arr.forEach(num => {
        counts[num] = (counts[num] || 0) + 1;
      });
      return counts;
    }

    function reloadNumbers() {
      const firstZoneElement = document.getElementById('firstZone');
      const secondZoneElement = document.getElementById('secondZone');

      // 清除上一次的數字
      firstZoneElement.textContent = '第一區：';
      secondZoneElement.textContent = '第二區：';

      // 進行1000次循環，統計每個號碼出現的次數
      const firstZoneCounts = {};
      const secondZoneCounts = {};
      for (let i = 0; i < 1000000; i++) {
        const firstZoneNumbers = getRandomNumbers(1, 38, 6);
        const secondZoneNumber = getRandomNumbers(1, 8, 1)[0];

        firstZoneNumbers.forEach(num => {
          firstZoneCounts[num] = (firstZoneCounts[num] || 0) + 1;
        });

        secondZoneCounts[secondZoneNumber] = (secondZoneCounts[secondZoneNumber] || 0) + 1;
      }

      // 找出第一區出現次數最多的前6個數字
      const sortedFirstZone = Object.keys(firstZoneCounts).sort((a, b) => firstZoneCounts[b] - firstZoneCounts[a]).slice(0, 6);
      firstZoneElement.textContent += sortedFirstZone.join(', ');

      // 找出第二區出現次數最多的1個數字
      const sortedSecondZone = Object.keys(secondZoneCounts).sort((a, b) => secondZoneCounts[b] - secondZoneCounts[a])[0];
      secondZoneElement.textContent += sortedSecondZone;
    }

    // 初始載入時呼叫一次
    reloadNumbers();
  </script>
        <div><hr></div>
      <div id="lotteryNumbers">大樂透建議(1,000,000次隨機)：</div>
  <button onclick="reloadLotteryNumbers()">Reload</button>

  <script>
    function getRandomNumbers(min, max, count) {
      const numbers = [];
      while (numbers.length < count) {
        const randomNum = Math.floor(Math.random() * (max - min + 1)) + min;
        if (!numbers.includes(randomNum)) {
          numbers.push(randomNum);
        }
      }
      return numbers.sort((a, b) => a - b);
    }

    function countOccurrences(arr) {
      const counts = {};
      arr.forEach(num => {
        counts[num] = (counts[num] || 0) + 1;
      });
      return counts;
    }

    function reloadLotteryNumbers() {
      const lotteryNumbersElement = document.getElementById('lotteryNumbers');

      // 清除上一次的數字
      lotteryNumbersElement.textContent = '大樂透建議(1,000,000次隨機)：';

      // 進行1000次循環，統計每組號碼出現的次數
      const allNumbers = [];
      for (let i = 0; i < 1000000; i++) {
        const lotteryNumbers = getRandomNumbers(1, 49, 6);
        allNumbers.push(...lotteryNumbers);
      }

      // 找出所有號碼出現次數
      const numberCounts = countOccurrences(allNumbers);

      // 找出出現次數最多的6個數字
      const sortedNumbers = Object.keys(numberCounts).sort((a, b) => numberCounts[b] - numberCounts[a]).slice(0, 6);

      lotteryNumbersElement.textContent += sortedNumbers.join(', ');
    }

    // 初始載入時呼叫一次
    reloadLotteryNumbers();
  </script>
</body>

</html>
